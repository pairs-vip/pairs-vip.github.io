{"title":"DevTips(Java)","date":"2025-09-01T01:55:00.000Z","date_formatted":{"ll":"Sep 1, 2025","L":"09/01/2025","MM-DD":"09-01"},"author":"zmu","link":"2025/09/01/DevTips(Java)","tags":["tips"],"categories":["dev"],"updated":"2025-09-01T01:55:00.000Z","content":"<h1 id=\"devtips(java)\">DevTips(Java)<a title=\"#devtips(java)\" href=\"#devtips(java)\"></a></h1>\n<h4 id=\"1.@requestbody-不能和文件参数（multipartfile）同时使用。\">1.<code>@RequestBody</code> 不能和文件参数（<code>MultipartFile</code>）同时使用。<a title=\"#1.@requestbody-不能和文件参数（multipartfile）同时使用。\" href=\"#1.@requestbody-不能和文件参数（multipartfile）同时使用。\"></a></h4>\n<p><strong>原因分析</strong></p>\n<ul>\n<li><strong>HTTP请求内容类型冲突</strong>\n<ul>\n<li><code>@RequestBody</code> 期望 <code>Content-Type: application/json</code> 或类似类型，用于读取整个请求体作为单个对象`</li>\n<li><code>文件上传使用 </code>Content-Type: multipart/form-data`，请求体被分成多个部分（parts）</li>\n</ul>\n</li>\n<li><strong>Spring MVC的处理机制</strong></li>\n</ul>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> <span class=\"string\">/upload</span> <span class=\"meta\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"attribute\">Content-Type</span><span class=\"punctuation\">: </span>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-pgsql\"><span class=\"comment\">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span></span><br><span class=\"line\"><span class=\"language-pgsql\">Content-Disposition: form-data; <span class=\"type\">name</span>=&quot;file&quot;; filename=&quot;test.dat&quot;</span></span><br><span class=\"line\"><span class=\"language-pgsql\">Content-<span class=\"keyword\">Type</span>: application/octet-stream</span></span><br><span class=\"line\"><span class=\"language-pgsql\"></span></span><br><span class=\"line\"><span class=\"language-pgsql\">[文件二进制内容]</span></span><br><span class=\"line\"><span class=\"language-pgsql\"><span class=\"comment\">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></span></span><br><span class=\"line\"><span class=\"language-pgsql\">Content-Disposition: form-data; <span class=\"type\">name</span>=&quot;hexStr&quot;</span></span><br><span class=\"line\"><span class=\"language-pgsql\"></span></span><br><span class=\"line\"><span class=\"language-pgsql\">额外的<span class=\"number\">16</span>进制字符串</span></span><br><span class=\"line\"><span class=\"language-pgsql\"><span class=\"comment\">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span></span></span><br></pre></td></tr></table></figure>\n<h4 id=\"2.elasticsearch-exception-[type=cluster_block_exception,-reason=blocked-by:-[forbidden/12/index-read-only-/-allow-delete-(api)];]&quot;}\">2.Elasticsearch exception [type=cluster_block_exception, reason=blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];]&quot;}<a title=\"#2.elasticsearch-exception-[type=cluster_block_exception,-reason=blocked-by:-[forbidden/12/index-read-only-/-allow-delete-(api)];]&quot;}\" href=\"#2.elasticsearch-exception-[type=cluster_block_exception,-reason=blocked-by:-[forbidden/12/index-read-only-/-allow-delete-(api)];]&quot;}\"></a></h4>\n<ul>\n<li>\n<p>es存储内存不足报错，导致无法正常使用，紧急解决方案：</p>\n<p>在kibana的dev Tools控制台中输入命令执行：</p>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT _all/_settings</span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;index.blocks.read_only_allow_delete&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">null</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>查询es内存存储状态命令，kibana中输入指令执行：</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET _cat/allocation?v</span><br></pre></td></tr></table></figure>\n<h4 id=\"3.org.apache.commons.lang3.stringutils.isnotblank()和isnotempty的区别\">3.org.apache.commons.lang3.StringUtils.isNotBlank()和isNotEmpty的区别<a title=\"#3.org.apache.commons.lang3.stringutils.isnotblank()和isnotempty的区别\" href=\"#3.org.apache.commons.lang3.stringutils.isnotblank()和isnotempty的区别\"></a></h4>\n<p><code>StringUtils.isNotBlank</code> 和 <code>StringUtils.isNotEmpty</code> 都用于检查字符串是否“有效”，但它们的判断标准有<strong>关键区别</strong>。</p>\n<p>简单来说，<strong><code>isNotBlank</code> 是 <code>isNotEmpty</code> 的“加强版”</strong>，它更严格。</p>\n<hr>\n<p><strong>核心区别</strong></p>\n<div class=\"φbq\"><div class=\"φbs\"><table><thead>\n<tr>\n<th style=\"text-align:left\">方法</th>\n<th style=\"text-align:left\">关注点</th>\n<th style=\"text-align:left\">检查内容</th>\n<th style=\"text-align:left\">严格程度</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong><code>isNotEmpty(String str)</code></strong></td>\n<td style=\"text-align:left\"><strong>长度</strong></td>\n<td style=\"text-align:left\">字符串<strong>不为 <code>null</code></strong> 且<strong>长度大于零</strong> (<code>length() &gt; 0</code>)</td>\n<td style=\"text-align:left\">较宽松</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>isNotBlank(String str)</code></strong></td>\n<td style=\"text-align:left\"><strong>内容</strong></td>\n<td style=\"text-align:left\">字符串<strong>不为 <code>null</code></strong>、<strong>长度大于零</strong>且<strong>包含至少一个非空白字符</strong></td>\n<td style=\"text-align:left\">更严格</td>\n</tr>\n</tbody>\n</table></div></div><p><strong><code>isNotBlank</code> 在 <code>isNotEmpty</code> 的基础上，额外排除了纯空白字符（如空格、制表符、换行符等）的情况。</strong></p>\n<h4 id=\"4.分页对象实体需要进行转换的场景\">4.分页对象实体需要进行转换的场景<a title=\"#4.分页对象实体需要进行转换的场景\" href=\"#4.分页对象实体需要进行转换的场景\"></a></h4>\n<p><strong>通过JPA框架查询回来的分页中对象是数据库中的对象类型，直接返回给前端不合适，所以需要将分页中对象进行转换成VO后返回给前端，并且不影响其他部分，例如分页信息(page,size)</strong></p>\n<p><strong>直接使用分页对象.map遍历，然后执行转换方法即可。</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Page&lt;?&gt;.map(entity -&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> convert(batchEntity)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// controller</span></span><br><span class=\"line\">Page&lt;DeliveryBatchEntity&gt; deliveryBatchEntities = deliveryBatchService.pageBatches(form, PageRequest.of(page, size));</span><br><span class=\"line\"><span class=\"comment\">// 将分页content转换为DeliveryBatchVO类型展示</span></span><br><span class=\"line\">Page&lt;DeliveryBatchVO&gt; batchVOPage = deliveryBatchEntities.map(deliveryBatchConverter::convert);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//service调用JPA框架直接查询出分页</span></span><br><span class=\"line\">Page&lt;DeliveryBatchEntity&gt; deliveryBatchEntityPage = deliveryBatchRepository.findAll(Example.of(deliveryBatchEntityQuery,matcher), pageable);</span><br></pre></td></tr></table></figure>\n<h4 id=\"5.通过example.of()进行模糊查询\">5.通过Example.of()进行模糊查询<a title=\"#5.通过example.of()进行模糊查询\" href=\"#5.通过example.of()进行模糊查询\"></a></h4>\n<p>通过这条语句配置那些字段进行模糊查询。</p>\n<p><em><strong>matcher = matcher.withMatcher(“batchName”, ExampleMatcher.GenericPropertyMatchers.contains());</strong></em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Page&lt;DeliveryBatchEntity&gt; <span class=\"title function_\">pageBatches</span><span class=\"params\">(DeliveryBatchFormDTO form, Pageable pageable)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">DeliveryBatchEntity</span> <span class=\"variable\">deliveryBatchEntityQuery</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DeliveryBatchEntity</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 添加模糊查询</span></span><br><span class=\"line\">    <span class=\"type\">ExampleMatcher</span> <span class=\"variable\">matcher</span> <span class=\"operator\">=</span> ExampleMatcher.matching()</span><br><span class=\"line\">        .withStringMatcher(ExampleMatcher.StringMatcher.CONTAINING)</span><br><span class=\"line\">        .withIgnoreCase();</span><br><span class=\"line\">    matcher = matcher.withMatcher(<span class=\"string\">&quot;batchName&quot;</span>, ExampleMatcher.GenericPropertyMatchers.contains());</span><br><span class=\"line\">    <span class=\"comment\">// 封装查询对象</span></span><br><span class=\"line\">    deliveryBatchEntityQuery.setRepositoryId(form.getRepositoryId());</span><br><span class=\"line\">    deliveryBatchEntityQuery.setBatchType(form.getBatchType());</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(StringUtils.isNotBlank(form.getBatchName()))&#123;</span><br><span class=\"line\">        deliveryBatchEntityQuery.setBatchName(form.getBatchName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Page&lt;DeliveryBatchEntity&gt; deliveryBatchEntityPage = deliveryBatchRepository.findAll(</span><br><span class=\"line\">        Example.of(deliveryBatchEntityQuery,matcher), pageable);</span><br><span class=\"line\">    <span class=\"keyword\">return</span>  deliveryBatchEntityPage;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"6.jpa通过queryspec进行多表联查及条件筛选（corilead版本，封装原版的queryspec）\">6.JPA通过QuerySpec进行多表联查及条件筛选（Corilead版本，封装原版的QuerySpec）<a title=\"#6.jpa通过queryspec进行多表联查及条件筛选（corilead版本，封装原版的queryspec）\" href=\"#6.jpa通过queryspec进行多表联查及条件筛选（corilead版本，封装原版的queryspec）\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Page&lt;AbstractPart&gt; <span class=\"title function_\">getDesignPartByFolder</span><span class=\"params\">(String folderId,DeliveryBomDTO query, Pageable pageable)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">QuerySpec</span> <span class=\"variable\">querySpec</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">QuerySpec</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 添加第一个表 C_FOLDER_MEMBERS</span></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">folderMemberTableIndex</span> <span class=\"operator\">=</span> querySpec.appendTable(FolderMemberEntity.class.getName(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 添加第二个表 C_DESIGN_PART</span></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">designPartTableIndex</span> <span class=\"operator\">=</span> querySpec.appendTable(DesignPart.class.getName(), <span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 添加第三个表 C_DESIGN_PART_MASTER</span></span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">designPartMasterTableIndex</span> <span class=\"operator\">=</span> querySpec.appendTable(DesignPartMaster.class.getName(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 构建关联条件：FOLDER_MEMBER.ObjectId = DESIGN_PART.MASTER_ID</span></span><br><span class=\"line\">    <span class=\"type\">SearchCondition</span> <span class=\"variable\">joinCondition1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;objectId&quot;</span>,</span><br><span class=\"line\">        SearchCondition.EQUAL,</span><br><span class=\"line\">        <span class=\"string\">&quot;masterId&quot;</span>,</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;folderMemberTableIndex, designPartTableIndex&#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 构建关联条件：FOLDER_MEMBER.ObjectType = DESIGN_PART.MASTER_TYPE</span></span><br><span class=\"line\">    <span class=\"type\">SearchCondition</span> <span class=\"variable\">joinCondition2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;objectType&quot;</span>,</span><br><span class=\"line\">        SearchCondition.EQUAL,</span><br><span class=\"line\">        <span class=\"string\">&quot;masterType&quot;</span>,</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;folderMemberTableIndex, designPartTableIndex&#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 构建关联条件：C_DESIGN_PART.masterId = C_DESIGN_PART_MASTER.id</span></span><br><span class=\"line\">    <span class=\"type\">SearchCondition</span> <span class=\"variable\">joinCondition3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;masterId&quot;</span>,</span><br><span class=\"line\">        SearchCondition.EQUAL,</span><br><span class=\"line\">        <span class=\"string\">&quot;id&quot;</span>,</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;designPartTableIndex, designPartMasterTableIndex&#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// 合并关联条件</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用 AND 连接关联条件</span></span><br><span class=\"line\">    querySpec.appendWhere(joinCondition1);</span><br><span class=\"line\">    querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">    querySpec.appendWhere(joinCondition2);</span><br><span class=\"line\">    querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">    querySpec.appendWhere(joinCondition3);</span><br><span class=\"line\">    querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">    <span class=\"comment\">// 添加条件：FOLDER_MEMBER.FOLDER_ID = 传入参数 folderId</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (folderId != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"type\">SearchCondition</span> <span class=\"variable\">folderCondition</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;folderId&quot;</span>,</span><br><span class=\"line\">            SearchCondition.EQUAL,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">AttributeValue</span>(folderId),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;folderMemberTableIndex&#125;</span><br><span class=\"line\">        );</span><br><span class=\"line\">        querySpec.appendWhere(folderCondition);</span><br><span class=\"line\">        querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 获取最新版本</span></span><br><span class=\"line\">    <span class=\"type\">SearchCondition</span> <span class=\"variable\">searchCondition</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;latestIteration&quot;</span>,</span><br><span class=\"line\">        SearchCondition.EQUAL,</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">AttributeValue</span>(<span class=\"literal\">true</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;designPartTableIndex&#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">    querySpec.appendWhere(searchCondition);</span><br><span class=\"line\">    <span class=\"comment\">// 添加查询条件编号</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isNotBlank(query.getCode()))&#123;</span><br><span class=\"line\">        querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">        <span class=\"type\">SearchCondition</span> <span class=\"variable\">searchConditionCode</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;code&quot;</span>,</span><br><span class=\"line\">            SearchCondition.LIKE,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">AttributeValue</span>(<span class=\"string\">&quot;%&quot;</span>+ query.getCode() +<span class=\"string\">&quot;%&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;designPartMasterTableIndex&#125;</span><br><span class=\"line\">        );</span><br><span class=\"line\">        querySpec.appendWhere(searchConditionCode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 添加查询条件产品名称</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isNotBlank(query.getProductName()))&#123;</span><br><span class=\"line\">        querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">        <span class=\"type\">SearchCondition</span> <span class=\"variable\">searchConditionProductName</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>,</span><br><span class=\"line\">            SearchCondition.LIKE,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">AttributeValue</span>(<span class=\"string\">&quot;%&quot;</span>+ query.getProductName() +<span class=\"string\">&quot;%&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;designPartMasterTableIndex&#125;</span><br><span class=\"line\">        );</span><br><span class=\"line\">        querySpec.appendWhere(searchConditionProductName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 添加查询条件状态</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isNotBlank(query.getState()))&#123;</span><br><span class=\"line\">        querySpec.appendWhere(SearchCondition.AND);</span><br><span class=\"line\">        <span class=\"type\">SearchCondition</span> <span class=\"variable\">searchConditionState</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SearchCondition</span>(</span><br><span class=\"line\">            <span class=\"string\">&quot;stateId&quot;</span>,</span><br><span class=\"line\">            SearchCondition.EQUAL,</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">AttributeValue</span>(Long.valueOf(query.getState())),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[] &#123;designPartTableIndex&#125;</span><br><span class=\"line\">        );</span><br><span class=\"line\">        querySpec.appendWhere(searchConditionState);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 排序</span></span><br><span class=\"line\">    <span class=\"type\">Sort</span> <span class=\"variable\">sort</span> <span class=\"operator\">=</span> pageable.getSort();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Sort.unsorted().equals(sort)) &#123;</span><br><span class=\"line\">        querySpec.appendOrderBy(<span class=\"keyword\">new</span> <span class=\"title class_\">OrderBy</span>(<span class=\"string\">&quot;modifyStamp&quot;</span>, <span class=\"string\">&quot;desc&quot;</span>, designPartTableIndex));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Sort.Order order : sort) &#123;</span><br><span class=\"line\">            querySpec.appendOrderBy(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">OrderBy</span>(order.getProperty(), (order.isAscending()) ? <span class=\"string\">&quot;asc&quot;</span> : <span class=\"string\">&quot;desc&quot;</span>, designPartTableIndex));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Page&lt;AbstractPart&gt; abstractParts = persistenceService.find(querySpec, pageable);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> abstractParts;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"7.接口接收附件，单个以及多个写法（参数使用multipartfile[]不对，要使用list&lt;multipartfile&gt;)\">7.接口接收附件，单个以及多个写法（参数使用MultipartFile[]不对，要使用<code>List&lt;MultipartFile&gt;</code>)<a title=\"#7.接口接收附件，单个以及多个写法（参数使用multipartfile[]不对，要使用list&lt;multipartfile&gt;)\" href=\"#7.接口接收附件，单个以及多个写法（参数使用multipartfile[]不对，要使用list&lt;multipartfile&gt;)\"></a></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 多个附件</span></span><br><span class=\"line\"><span class=\"meta\">@Operation(summary = &quot;上传文件&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(</span></span><br><span class=\"line\"><span class=\"meta\">    value = &quot;/data-package/import&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">    consumes = MediaType.MULTIPART_FORM_DATA_VALUE,</span></span><br><span class=\"line\"><span class=\"meta\">    name = &quot;数据包批量导入处理&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ResponseEntity&lt;?&gt; upload(</span><br><span class=\"line\">    <span class=\"meta\">@RequestParam(value = &quot;fileList&quot;, required = false)</span> List&lt;MultipartFile&gt; fileList) &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 单个附件</span></span><br><span class=\"line\"><span class=\"meta\">@Operation(summary = &quot;上传文件&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(</span></span><br><span class=\"line\"><span class=\"meta\">    value = &quot;/data-package/import&quot;,</span></span><br><span class=\"line\"><span class=\"meta\">    consumes = MediaType.MULTIPART_FORM_DATA_VALUE,</span></span><br><span class=\"line\"><span class=\"meta\">    name = &quot;数据包批量导入处理&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ResponseEntity&lt;?&gt; upload(</span><br><span class=\"line\">    <span class=\"meta\">@RequestParam(value = &quot;file&quot;, required = false)</span> MultipartFile file) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Hexo-blog使用指南","link":"2025/09/01/Hexo-blog使用指南"},"next":{"title":"十进制数转任意进制","link":"2025/08/27/十进制数转任意进制"},"plink":"http://example.com/2025/09/01/DevTips(Java)/","toc":[{"id":"devtips(java)","title":"DevTips(Java)","index":"1"}],"reading_time":"1318 words in 9 min"}